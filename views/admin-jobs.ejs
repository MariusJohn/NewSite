<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <title>MC Quote - Admin Dashboard</title>
    <link rel="stylesheet" href="/css/admin-dashboard.css">
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css" rel="stylesheet">
</head>

<body>
<div class="admin-dashboard-container">
    <!-- Sidebar -->
    <div class="sidebar">
        <a href="/."><img src="/img/logo.png" alt="MC Quote Logo"></a>
        <h2>Admin Panel</h2>
        <ul class="menu">
            <li><a href="/jobs/admin?filter=total">Total Jobs (<%= totalCount %>)</a></li>
            <li><a href="/jobs/admin?filter=live">Live Jobs (<%= liveCount %>)</a></li>
            <li><a href="/jobs/admin?filter=approved">Approved Jobs (<%= approvedCount %>)</a></li>
            <li><a href="/jobs/admin?filter=rejected">Rejected Jobs (<%= rejectedCount %>)</a></li>
            <li><a href="/jobs/admin?filter=archived">Archived Jobs (<%= archivedCount %>)</a></li>
            <li><a href="/jobs/admin?filter=deleted">Deleted Jobs (<%= deletedCount %>)</a></li>
            <li><a href="/jobs/admin/quotes">Jobs with Quotes</a></li>
            <li><a href="/jobs/admin/bodyshops">Bodyshops</a></li>
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main-content">
        <h1>Submitted Jobs</h1>

        <% if (jobs.length === 0) { %>
            <p>No jobs available at the moment.</p>
        <% } else { %>
            <table class="jobs-table">
                <thead>
                    <tr>
                        <th>Job ID</th>
                        <th>Customer Details</th>
                        <th>Images</th>
                        <th>Status</th>
                        <th>Days Pending</th>
                        <th>Quote Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    <% jobs.forEach(job => { %>
                        <tr>
                            <td><%= job.id %></td>
                            <td>
                                <strong>Name:</strong> <%= job.customerName %><br>
                                <strong>Email:</strong> <%= job.customerEmail %><br>
                                <strong>Phone:</strong> <%= job.customerPhone %><br>
                                <strong>Location:</strong> <%= job.location %>
                            </td>
                            <td>
                                <div class="image-preview-block">
                                    <% if (job.images && job.images.length > 0) { %>
                                        <% job.images.forEach(function(image, index) { %>
                                            <a 
                                                href="/uploads/job-images/<%= image %>" 
                                                class="glightbox" 
                                                data-gallery="job-<%= job.id %>" 
                                                data-title="Job Image <%= index + 1 %>">
                                                <img 
                                                    src="/uploads/job-images/<%= image %>" 
                                                    alt="Job Image" 
                                                    class="thumb-img">
                                            </a>
                                        <% }) %>
                                    <% } else { %>
                                        <em>No Images</em>
                                    <% } %>
                                </div>
                            </td>
                            <td>
                                <span class="status-badge status-<%= job.status %>"><%= job.status || 'Pending' %></span>
                            </td>
                            <td>
                                <%= job.daysPending || 0 %> days
                            </td>
                            <td>
                                <%= job.quoteStatus || 'no_quotes' %>
                            </td>
                            <td class="job-actions">
                                <% if (job.status === 'pending') { %>
                                    <form action="/jobs/<%= job.id %>/approve" method="POST">
                                        <button type="submit">Approve</button>
                                    </form>
                                    <form action="/jobs/<%= job.id %>/reject" method="POST">
                                        <button type="submit">Reject</button>
                                    </form>
                                <% } else if (job.status === 'approved') { %>
                                    <em>Approved</em>
                                <% } else if (job.status === 'rejected') { %>
                                    <form action="/jobs/<%= job.id %>/restore" method="POST">
                                        <button type="submit" class="restore-btn">Restore</button>
                                    </form>
                                    <form action="/jobs/<%= job.id %>/archive" method="POST">
                                        <button type="submit" class="archive-btn">Archive</button>
                                    </form>
                                <% } else if (job.status === 'archived') { %>
                                    <form action="/jobs/<%= job.id %>/restore" method="POST">
                                        <button type="submit" class="restore-btn">Restore</button>
                                    </form>
                                    <form action="/jobs/<%= job.id %>/delete" method="POST" onsubmit="return confirm('Are you sure you want to permanently delete this job?')">
                                        <button type="submit" class="delete-btn">Delete</button>
                                    </form>
                                <% } else if (job.status === 'deleted') { %>
                                    <em>Deleted</em>
                                <% } %>
                                <a href="/bodyshop/download/<%= job.id %>" class="download-zip-btn">ðŸ“¦ Download Images</a>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        <% } %>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>
<script>
    const lightbox = GLightbox({
        selector: '.glightbox',
        touchNavigation: true,
        loop: true,
        onOpen: () => {
            document.body.style.overflow = 'hidden';
        },
        onClose: () => {
            document.body.style.overflow = 'auto';
        }
    });
</script>
</body>
</html>