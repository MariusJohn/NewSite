<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Bodyshop Dashboard - Available Jobs</title>
    <link rel="stylesheet" href="/css/navbar.css">
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/reset.css">
    <link rel="stylesheet" href="/css/footer.css">
    <link rel="stylesheet" href="/css/bodyshop-dashboard.css">
    <link href="https://cdn.jsdelivr.net/npm/glightbox/dist/css/glightbox.min.css" rel="stylesheet">
</head>

<body>
<div class="page-wrapper">
<main class="dashboard-main">
    <section class="dashboard-section">
        <h1>Available Jobs for Quoting</h1>

        <% if (jobs.length === 0) { %>
            <p>No jobs available at the moment. Please check back later.</p>
        <% } else { %>
            <table class="jobs-table">
                <thead>
                    <tr>
                        <th>Customer Location</th>
                        <th>Distance (miles)</th>
                        <th>Images</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    <% jobs.forEach(job => { %>
                        <tr>
                            <td><%= job.location %></td>
                            <td><%= job.dataValues.distance ? job.dataValues.distance.toFixed(2) : "N/A" %></td>
                            <td>
                                <div class="image-preview-block">
                                    <% if (job.images && job.images.length > 0) { %>
                                        <% job.images.forEach(function(image, index) { %>
                                            <a 
                                                href="/uploads/job-images/<%= image %>" 
                                                class="glightbox"
                                                data-gallery="job-<%= job.id %>"
                                                data-title="Image <%= index + 1 %>"
                                            >
                                                <img 
                                                    src="/uploads/job-images/<%= image %>" 
                                                    alt="Job Image" 
                                                    class="thumb-img"
                                                >
                                            </a>
                                        <% }) %>
                                    <% } else { %>
                                        <em>No Images</em>
                                    <% } %>
                                </div>
                            </td>
                            <td>
                                <form action="/bodyshop/quote/<%= job.id %>" method="POST">
                                    <input type="number" name="quoteAmount" placeholder="Your quote (Â£)" required>
                                    <button type="submit" class="btn">Submit Quote</button>
                                </form>
                                <a href="/bodyshop/download/<%= job.id %>" class="download-zip-btn">ðŸ“¦ Download All Images</a>
                            </td>
                        </tr>
                    <% }) %>
                </tbody>
            </table>
        <% } %>
    </section>
</main>

<%- include('partials/footer') %>

</div>

<script src="https://cdn.jsdelivr.net/npm/glightbox/dist/js/glightbox.min.js"></script>
<script>
  const lightbox = GLightbox({
    selector: '.glightbox'
  });
</script>

</body>
</html>